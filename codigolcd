#include <Keypad.h>
#include <LiquidCrystal.h>

const byte ROWS = 4; // Four rows
const byte COLS = 3; // Three columns

char keys[ROWS][COLS] = {
  {'1','2','3'},
  {'4','5','6'},
  {'7','8','9'},
  {'*','0','#'}
};
// Connect keypad ROW0, ROW1, ROW2 and ROW3 to these Arduino pins.
byte rowPins[ROWS] = {A5, A4, A3, A2};
// Connect keypad COL0, COL1 and COL2 to these Arduino pins.
byte colPins[COLS] = {2, 4, 5}; 

// Create the Keypad
Keypad kpd = Keypad( makeKeymap(keys), rowPins, colPins, ROWS, COLS );

int contador = 0;
int buzzer = 1;
int releuv = 2;
int releSecador = 6; 
int timeCent = 11;
int timeSecagem = 11;
int timeLV = 16;
int timeCorrosao = 11;
int tempo_Centrifuga = 11000;
int tempo_Secagem = 11000;
int tempo_LV = 16000;
int tempo_Corrosao = 11000;

char key;

#define MotorPin 3

void modoautomatico();
void displaylcd();
void modomanual();
void configuracoes();
void ajuda();
void centrifuga();
void secagem();
void luzvioleta();
void corrosao();

LiquidCrystal lcd(12, 8, 7, 9, 10, 11);

void setup()
{
  pinMode(MotorPin, OUTPUT);
  pinMode(releuv, OUTPUT);
  pinMode(releSecador, OUTPUT);
  lcd.begin(20, 4);
  Serial.begin(9600);
}
  
void loop()
{
  displaylcd();
}

void displaylcd()
{
  unsigned long time;
  lcd.clear();
  lcd.cursor();
  lcd.blink();
  lcd.setCursor(0, 0);
  lcd.print("->Modo Automatico");
  lcd.setCursor(0, 1);
  lcd.print("Aperte o botao *");
  time = millis();
  do {
    key = kpd.getKey();
    if (key && key=='*') {
      modoautomatico();
    }
  } while (millis() - time < 3001);
  lcd.clear();
  lcd.setCursor(0, 0);
  lcd.print("->Modo Manual");
  lcd.setCursor(0, 1);
  lcd.print("Aperte o botao *");
  time = millis();
  do {
    key = kpd.getKey();
    if (key && key=='*') {
      modomanual();
    }
  } while (millis() - time < 3001);
  lcd.clear();
  lcd.setCursor(0, 0);
  lcd.print("->Configuracoes");
  lcd.setCursor(0, 1);
  lcd.print("Aperte o botao *");
  time = millis();
  do {
    key = kpd.getKey();
    if (key && key=='*') {
      configuracoes();
    }
  } while (millis() - time < 3001);
  lcd.clear();
  lcd.setCursor(0, 0);
  lcd.print("->Ajuda");
  lcd.setCursor(0, 1);
  lcd.print("Aperte o botao *");
  time = millis();
  do {
    key = kpd.getKey();
    if (key && key=='*') {
      ajuda();
    }
  } while (millis() - time < 3001);
}

void modoautomatico()
{
  lcd.clear();
  lcd.setCursor(0, 0);
  lcd.print("Incializando...");
  delay(8000);
  lcd.clear();
  lcd.cursor();
  lcd.setCursor(0, 0);
  lcd.print("->Lave a placa");
  lcd.setCursor(0, 1);
  lcd.print("->com bombril");
  delay(5000);
  lcd.clear();
  lcd.cursor();
  lcd.setCursor(0, 0);
  lcd.print("-> Apos o termino");
  lcd.setCursor(0, 1);
  lcd.print("Pressione o botao *");
  do {
    key = kpd.getKey();
  } while (key != '*');
  lcd.clear();
  lcd.cursor();
  lcd.setCursor(0, 0);
  lcd.print("->Seque a placa");
  delay(5000);
  lcd.clear();
  lcd.cursor();
  lcd.setCursor(0, 0);
  lcd.print("-> Apos o termino");
  lcd.setCursor(0, 1);
  lcd.print("Pressione o botao *");
  do {
    key = kpd.getKey();
  } while (key != '*');
  lcd.clear();
  lcd.cursor();
  lcd.setCursor(0, 0);
  lcd.print("->Pinte a placa");
  delay(5000);
  lcd.clear();
  lcd.cursor();
  lcd.setCursor(0, 0);
  lcd.print("-> Apos o termino");
  lcd.setCursor(0, 1);
  lcd.print("Pressione o botao *");
  do {
    key = kpd.getKey();
  } while (key != '*');
  lcd.clear();
  lcd.setCursor(0, 0);
  lcd.print("->Agora vamos usar a");
  lcd.setCursor(5, 1);
  lcd.print("->Centrifuga");
  delay(5000);
  centrifuga();
  lcd.clear();
  lcd.setCursor(0, 0);
  lcd.print("->Vamos usar");
  lcd.setCursor(0, 1);
  lcd.print("a secagem");
  delay(5000);
  secagem();
  lcd.clear();
  lcd.setCursor(0, 0);
  lcd.print("->Colocar o");
  lcd.setCursor(0 , 1);
  lcd.print("fotolito");
  delay(5000);
  lcd.clear();
  lcd.cursor();
  lcd.setCursor(0, 0);
  lcd.print("-> Apos o termino");
  lcd.setCursor(0, 1);
  lcd.print("Pressione o botao *");
  do {
    key = kpd.getKey();
  } while (key != '*');
  lcd.clear();
  lcd.setCursor(0, 0);
  lcd.print("->Usar a luz ultravioleta");
  delay(5000);
  luzvioleta();
  lcd.clear();
  lcd.setCursor(0, 0);
  lcd.print("->Usar a barrilha");
  delay(5000);
  lcd.clear();
  lcd.cursor();
  lcd.setCursor(0, 0);
  lcd.print("-> Apos o termino");
  lcd.setCursor(0, 1);
  lcd.print("Pressione o botao *");
  do {
    key = kpd.getKey();
  } while (key != '*');
  lcd.clear();
  lcd.cursor();
  lcd.setCursor(0, 0);
  lcd.print("->Retirar a tinta");
  delay(5000);
  lcd.clear();
  lcd.cursor();
  lcd.setCursor(0, 0);
  lcd.print("-> Apos o termino");
  lcd.setCursor(0, 1);
  lcd.print("Pressione o botao *");
  do {
    key = kpd.getKey();
  } while (key != '*');
  lcd.clear();
  lcd.cursor();
  lcd.setCursor(0, 0);
  lcd.print("->Novamente usar");
  lcd.setCursor(0, 1);
  lcd.print("a luz UV");
  delay(5000);
  luzvioleta();
  lcd.clear();
  lcd.cursor();
  lcd.setCursor(0, 0);
  lcd.print("->Usar o hipercloreto");
  delay(5000);
  corrosao();
  lcd.clear();
  lcd.setCursor(0, 0);
  lcd.print("->Lavar placa");
  delay(5000);
  lcd.setCursor(0, 1);
  lcd.print("->Usar soda caustica");
  delay(5000);
  lcd.setCursor(0, 2);
  lcd.print("->Cortar e lixar placa");
  delay(5000);
  lcd.setCursor(0, 3);
  lcd.print("->Trabalhar as legendas");
  delay(5000);
  lcd.clear();
  lcd.setCursor(0, 0);
  lcd.print("->Agora, repetir as etapas de:");
  delay(5000);
  lcd.setCursor(0, 1);
  lcd.print("->Limpar, Pintar, Centrifugar, Secar");
  delay(5000);
  lcd.setCursor(0, 2);
  lcd.print("->Colocar a mascara");
  delay(5000);
  lcd.setCursor(0, 3);
  lcd.print("->Utilizar barrilha");
  delay(5000);
  lcd.clear();
  lcd.setCursor(5, 1);
  lcd.print("Processo Finalizado");
  displaylcd();
}

void modomanual()
{
  unsigned long time;
  lcd.clear();
  lcd.cursor();
  lcd.blink();
  lcd.setCursor(0, 0);
  lcd.print("Qual processo");
  lcd.setCursor(0, 1);
  lcd.print("deseja ativar?");
  delay(3000);
  lcd.clear();
  lcd.setCursor(0, 0);
  lcd.print("->Centrifuga?");
  lcd.setCursor(0, 1);
  lcd.print("Aperte o botao *");
  time = millis();
  do {
    key = kpd.getKey();
    if (key && key=='*') {
      centrifuga();
      time = 0;
      lcd.clear();
      lcd.setCursor(0, 0);
      lcd.print("Se deseja ativar");
      lcd.setCursor(0, 1);
      lcd.print("outro processo,");
      lcd.setCursor(0, 2);
      lcd.print("aperte o botao *");
      time = millis();
      do {
        key = kpd.getKey();
        if (key && key == '*')
          modomanual();
      } while (millis() - time < 3001);
      displaylcd();
    }
  } while (millis() - time < 3001);
  lcd.clear();
  lcd.setCursor(0, 0);
  lcd.print("->Secagem?");
  lcd.setCursor(0, 1);
  lcd.print("Aperte o botao *");
  do {
    key = kpd.getKey();
    if (key && key == '*')
    {
      secagem();
      time = 0;
      lcd.clear();
      lcd.setCursor(0, 0);
      lcd.print("Se deseja ativar");
      lcd.setCursor(0, 1);
      lcd.print("outro processo,");
      lcd.setCursor(0, 2);
      lcd.print("aperte o botao *");
      time = millis();
      do {
        key = kpd.getKey();
        if (key && key == '*')
          modomanual();
      } while (millis() - time < 3001);
      displaylcd();
    }
  } while (millis() - time < 3001);
  lcd.clear();
  lcd.setCursor(0, 0);
  lcd.print("->Luz Ultravioleta?");
  lcd.setCursor(0, 1);
  lcd.print("Aperte o botao *");
  time = millis();
  do {
    key = kpd.getKey();
    if (key && key == '*')
    {
      luzvioleta();
      time = 0;
      lcd.clear();
      lcd.setCursor(0, 0);
      lcd.print("Se deseja ativar");
      lcd.setCursor(0, 1);
      lcd.print("outro processo,");
      lcd.setCursor(0, 2);
      lcd.print("aperte o botao *");
      time = millis();
      do {
        key = kpd.getKey();
        if (key && key == '*')
          modomanual();
      } while (millis() - time < 3001);
      displaylcd();
    }
  } while (millis() - time < 3001);
  lcd.clear();
  lcd.setCursor(0, 0);
  lcd.print("->Corrosao?");
  lcd.setCursor(0, 1);
  lcd.print("Aperte o botao *");
  time = millis();
  do {
    key = kpd.getKey();
    if (key && key == '*')
    {
      corrosao();
      time = 0;
      lcd.clear();
      lcd.setCursor(0, 0);
      lcd.print("Se deseja ativar");
      lcd.setCursor(0, 1);
      lcd.print("outro processo,");
      lcd.setCursor(0, 2);
      lcd.print("aperte o botao *");
      time = millis();
      do {
        key = kpd.getKey();
        if (key && key == '*')
          modomanual();
      } while (millis() - time < 3001);
      displaylcd();
    }
  } while (millis() - time < 3001);
  lcd.clear();
}

void configuracoes()
{
  String str;
  unsigned long time;
  lcd.clear();
  lcd.setCursor(0,0);
  lcd.print("Mudar tempo de uma");
  lcd.setCursor(0,1);
  lcd.print("funcao");
  lcd.setCursor(0,3);
  lcd.print("Escolha a funcao...");
  delay(7000);
  lcd.clear();
  lcd.setCursor(0,0);
  lcd.print("Digite o numero da funcao");
  delay(8000);
  lcd.clear();
  lcd.setCursor(0,0);
  lcd.print("1 - Centrifuga");
  lcd.setCursor(0,1);
  lcd.print("2 - Secagem");
  lcd.setCursor(0,2);
  lcd.print("3 - Luz Violeta");
  lcd.setCursor(0,3);
  lcd.print("4 - Corrosao");
  time = millis();
  do{
    key = kpd.getKey();
    if(key){
      if(key == '1'){
        lcd.clear();
        tempo_Centrifuga = 0;
        do{
          lcd.setCursor(0,0);
          key = kpd.getKey();
          if(key && key != '#'){
            str += String(key);
            tempo_Centrifuga = str.toInt();
            timeCent = tempo_Centrifuga/1000;
            lcd.print(tempo_Centrifuga);
          }
        }while(key != '*');
        break;
      }else if( key == '2'){
        lcd.clear();
        tempo_Secagem = 0;
        do{
          lcd.setCursor(0,0);
          key = kpd.getKey();
          if(key && key != '#'){
            str += String(key);
            tempo_Secagem = str.toInt();
            timeSecagem = tempo_Secagem/1000;
            lcd.print(tempo_Secagem);
          }
        }while(key != '*');
        break;
      }else if( key == '3'){
        lcd.clear();
        tempo_LV = 0;
        do{
          lcd.setCursor(0,0);
          key = kpd.getKey();
          if(key && key != '#'){
            str += String(key);
            tempo_LV = str.toInt();
            timeLV = tempo_LV/1000;
            lcd.print(tempo_LV);
          }
        }while(key != '*');
        break;
      }else if( key == '4'){
        lcd.clear();
        tempo_Corrosao = 0;
        do{
          lcd.setCursor(0,0);
          key = kpd.getKey();
          if(key && key != '#'){
            str += String(key);
            tempo_Corrosao = str.toInt();
            timeCorrosao = tempo_Corrosao/1000;
            lcd.print(tempo_Corrosao);
          }
        }while(key != '*');
        break;
      }
    }
  }while((millis() - time) < 60000);
  lcd.clear();
  displaylcd();
}

void ajuda()
{

}

void centrifuga()
{
  unsigned long tempo = 0;
  int contador = 0;
  lcd.clear();
  lcd.setCursor(0, 0);
  lcd.print("Centrifugando...");
  delay(2000);
  lcd.clear();
  lcd.print("Pressione para iniciar");
  do {
    key = kpd.getKey();
  } while (key != '*');
  lcd.clear();
  digitalWrite(MotorPin, HIGH);
  tempo = millis();
  for (contador; (millis() - tempo < tempo_Centrifuga) && (contador < timeCent); contador++)
  {
    lcd.print("Centrifugando");
    lcd.print(contador);
    delay(1000);
    lcd.clear();
    tempo = millis();
  }
  digitalWrite(MotorPin, LOW);
  do {
    tone(buzzer, 261);
    key = kpd.getKey();
  } while (key != '*');
  noTone(buzzer);
}

void secagem()
{
  //15 minutos quente
  //2 minutos frio (opcional)
  unsigned long tempo = 0;
  int contador = 0;

  lcd.clear();
  lcd.setCursor(0, 0);
  lcd.print("Secagem...");
  delay(3000);
  lcd.setCursor(0, 1);
  lcd.print("Pressione para iniciar");
  do {
    key = kpd.getKey();
  } while (key != '*');
  lcd.clear();
  lcd.setCursor(7, 0);
  lcd.print("Secando");
  delay(3000);
  lcd.clear();
  lcd.setCursor(10, 1);
  tempo = millis();
  digitalWrite(releSecador, HIGH);
  tempo = millis();
  for (contador; millis() - tempo < tempo_Secagem && contador < timeSecagem; contador++)
  {
    lcd.print("Secando...");
    lcd.print(contador);
    delay(1000);
    lcd.clear();
    tempo = millis();
  }
  digitalWrite(releSecador, LOW);
  lcd.setCursor(0,0);
  lcd.print("Aperte * para desligar");
  do {
    tone(buzzer, 261);
    key = kpd.getKey();
  } while (key != '*');
  noTone(buzzer);
}

void luzvioleta()
{
  //3 minutos
  unsigned long tempo = 0;
  int contador = 0;

  lcd.clear();
  lcd.setCursor(7, 0);
  lcd.print("Luz UV");
  delay(3000);
  lcd.clear();
  lcd.setCursor(10, 1);
  tempo = millis();
  digitalWrite(releuv, HIGH);
  for (contador; millis() - tempo < tempo_LV && contador < timeLV; contador++)
  {
    lcd.print("Luz UV...");
    lcd.print(contador);
    delay(1000);
    lcd.clear();
    tempo = millis();
  }
  digitalWrite(releuv, LOW);
  lcd.setCursor(0,0);
  lcd.print("Aperte * para desligar");
  do {
    tone(buzzer, 261);
    key = kpd.getKey();
  } while (key != '*');
  noTone(buzzer);
}

void corrosao()
{
  //15 a 20 minutos
  unsigned long tempo = 0;
  int contador = 0;

  lcd.clear();
  lcd.setCursor(7, 0);
  lcd.print("Corrosao...");
  delay(3000);
  lcd.setCursor(0, 1);
  lcd.print("Pressione para iniciar");
  do {
    key = kpd.getKey();
  } while (key != '*');
  lcd.clear();
  lcd.setCursor(7, 0);
  lcd.print("Corroendo");
  lcd.setCursor(10, 1);
  tempo = millis();
  digitalWrite(releSecador, HIGH);
  for (contador; tempo < tempo_Corrosao && contador < timeCorrosao; contador++)
  {
    lcd.print("Corroendo...");
    lcd.print(contador);
    delay(1000);
    lcd.clear();
    tempo = millis();
  }
  digitalWrite(releSecador, LOW);
  lcd.setCursor(0,0);
  lcd.print("Aperte * para desligar");
  do {
    tone(buzzer, 261);
    key = kpd.getKey();
  } while (key != '*');
  noTone(buzzer);
}
