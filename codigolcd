#include <Keypad.h>
#include <LiquidCrystal.h>

const byte ROWS = 4; // Four rows
const byte COLS = 4; // Three columns

char keys[ROWS][COLS] = {
  {'1','2','3','A'},
  {'4','5','6','B'},
  {'7','8','9','C'},
  {'*','0','#','D'}
};
// Connect keypad ROW0, ROW1, ROW2 and ROW3 to these Arduino pins.
byte rowPins[ROWS] = {6, 7, 8, 9};
// Connect keypad COL0, COL1 and COL2 to these Arduino pins.
byte colPins[COLS] = {A3, A2, A1, A0}; 

// Create the Keypad
Keypad kpd = Keypad( makeKeymap(keys), rowPins, colPins, ROWS, COLS );

int contador = 0;
int buzzer = 13;
int releuv = 0;
int releSecador = 1; 
int timeCent = 11;
int timeSecagem = 11;
int timeLV = 16;
int timeCorrosao = 11;
int tempo_Centrifuga = 11000;
int tempo_Secagem = 11000;
int tempo_LV = 16000;
int tempo_Corrosao = 11000;
int MotorPin = 10;

char key;

void modoautomatico();
void displaylcd();
void modomanual();
void configuracoes();
void ajuda();
void centrifuga();
void secagem();
void luzvioleta();
void corrosao();

LiquidCrystal lcd(12, 11, 5, 4, 3, 2);

void setup()
{
  pinMode(MotorPin, OUTPUT);
  pinMode(releuv, OUTPUT);
  pinMode(releSecador, OUTPUT);
  pinMode(A0, INPUT);
  pinMode(A1, INPUT);
  pinMode(A2, INPUT);
  pinMode(A3, INPUT);
  pinMode(6, OUTPUT);
  pinMode(7, OUTPUT);
  pinMode(8, OUTPUT);
  pinMode(9, OUTPUT);

  lcd.begin(20, 4);
  digitalWrite(releSecador, HIGH);
  digitalWrite(releuv, HIGH);
  digitalWrite(MotorPin, LOW);
}
  
void loop()
{
  displaylcd();
}

void displaylcd()
{
  unsigned long tempo;
  lcd.clear();
  lcd.setCursor(0,0);
  lcd.print("Ola! Seja bem vindo");
  lcd.setCursor(0,1);
  lcd.print("a produtora PCBMaker");
  lcd.setCursor(0,2);
  lcd.print("2000, by Carranca22");
  delay(5500);
  lcd.clear();
  lcd.setCursor(0,1);
  lcd.print("Por favor, digite o numero:");
  delay(1500);
  lcd.clear();
  lcd.setCursor(0,0);
  lcd.print("1 - Modo Automatico");
  lcd.setCursor(0,1);
  lcd.print("2 - Modo Manual");
  lcd.setCursor(0,2);
  lcd.print("3 - Configuracoes");
  lcd.setCursor(0,3);
  lcd.print("4 - Ajuda");
  do{
  key = kpd.getKey();
  if (key=='1') 
      modoautomatico();
  else if (key=='2')
      modomanual();
  else if (key=='3') 
      configuracoes();
  else if (key=='4') 
      ajuda();
  }while(key != '#');
}

void modoautomatico()
{
  lcd.clear();
  lcd.setCursor(0, 0);
  lcd.print("Incializando...");
  delay(4000);
  lcd.clear();
  lcd.cursor();
  lcd.setCursor(0, 0);
  lcd.print("Lave a placa com");
  lcd.setCursor(0, 1);
  lcd.print("bombril");
  delay(5000);
  lcd.clear();
  lcd.cursor();
  lcd.setCursor(0, 0);
  lcd.print("Apos o termino");
  lcd.setCursor(0, 1);
  lcd.print("Pressione o botao *");
  do {
    key = kpd.getKey();
  } while (key != '*');
  lcd.clear();
  lcd.cursor();
  lcd.setCursor(0, 0);
  lcd.print("->Seque a placa");
  delay(5000);
  lcd.clear();
  lcd.cursor();
  lcd.setCursor(0, 0);
  lcd.print("-> Apos o termino");
  lcd.setCursor(0, 1);
  lcd.print("Pressione o botao *");
  do {
    key = kpd.getKey();
  } while (key != '*');
  lcd.clear();
  lcd.cursor();
  lcd.setCursor(0, 0);
  lcd.print("->Pinte a placa");
  delay(5000);
  lcd.clear();
  lcd.cursor();
  lcd.setCursor(0, 0);
  lcd.print("-> Apos o termino");
  lcd.setCursor(0, 1);
  lcd.print("Pressione o botao *");
  do {
    key = kpd.getKey();
  } while (key != '*');
  lcd.clear();
  lcd.setCursor(0, 0);
  lcd.print("->Agora vamos usar a");
  lcd.setCursor(5, 1);
  lcd.print("->Centrifuga");
  delay(5000);
  centrifuga();
  lcd.clear();
  lcd.setCursor(0, 0);
  lcd.print("->Vamos usar");
  lcd.setCursor(0, 1);
  lcd.print("a secagem");
  delay(5000);
  secagem();
  lcd.clear();
  lcd.setCursor(0, 0);
  lcd.print("->Colocar o");
  lcd.setCursor(0 , 1);
  lcd.print("fotolito");
  delay(5000);
  lcd.clear();
  lcd.cursor();
  lcd.setCursor(0, 0);
  lcd.print("-> Apos o termino");
  lcd.setCursor(0, 1);
  lcd.print("Pressione o botao *");
  do {
    key = kpd.getKey();
  } while (key != '*');
  lcd.clear();
  lcd.setCursor(0, 0);
  lcd.print("->Usar a luz ultravioleta");
  delay(5000);
  luzvioleta();
  lcd.clear();
  lcd.setCursor(0, 0);
  lcd.print("->Usar a barrilha");
  delay(5000);
  lcd.clear();
  lcd.cursor();
  lcd.setCursor(0, 0);
  lcd.print("-> Apos o termino");
  lcd.setCursor(0, 1);
  lcd.print("Pressione o botao *");
  do {
    key = kpd.getKey();
  } while (key != '*');
  lcd.clear();
  lcd.cursor();
  lcd.setCursor(0, 0);
  lcd.print("->Retirar a tinta");
  delay(5000);
  lcd.clear();
  lcd.cursor();
  lcd.setCursor(0, 0);
  lcd.print("-> Apos o termino");
  lcd.setCursor(0, 1);
  lcd.print("Pressione o botao *");
  do {
    key = kpd.getKey();
  } while (key != '*');
  lcd.clear();
  lcd.cursor();
  lcd.setCursor(0, 0);
  lcd.print("->Novamente usar");
  lcd.setCursor(0, 1);
  lcd.print("a luz UV");
  delay(5000);
  luzvioleta();
  lcd.clear();
  lcd.cursor();
  lcd.setCursor(0, 0);
  lcd.print("->Usar o hipercloreto");
  delay(5000);
  corrosao();
  lcd.clear();
  lcd.setCursor(0, 0);
  lcd.print("->Lavar placa");
  delay(5000);
  lcd.setCursor(0, 1);
  lcd.print("->Usar soda caustica");
  delay(5000);
  lcd.setCursor(0, 2);
  lcd.print("->Cortar e lixar placa");
  delay(5000);
  lcd.setCursor(0, 3);
  lcd.print("->Trabalhar as legendas");
  delay(5000);
  lcd.clear();
  lcd.setCursor(0, 0);
  lcd.print("->Agora, repetir as etapas de:");
  delay(5000);
  lcd.setCursor(0, 1);
  lcd.print("->Limpar, Pintar, Centrifugar, Secar");
  delay(5000);
  lcd.setCursor(0, 2);
  lcd.print("->Colocar a mascara");
  delay(5000);
  lcd.setCursor(0, 3);
  lcd.print("->Utilizar barrilha");
  delay(5000);
  lcd.clear();
  lcd.setCursor(5, 1);
  lcd.print("Processo Finalizado");
  displaylcd();
}

void modomanual(){
  unsigned long tempo;
  lcd.clear();
  lcd.cursor();
  lcd.blink();
  lcd.setCursor(0, 0);
  lcd.print("Qual processo");
  lcd.setCursor(0, 1);
  lcd.print("deseja ativar?");
  lcd.setCursor(0, 2);
  lcd.print("Aperte D para sair");
  delay(3000);
  lcd.clear();
  lcd.setCursor(0,0);
  lcd.print("1 - Centrifuga");
  lcd.setCursor(0,1);
  lcd.print("2 - Secagem");
  lcd.setCursor(0,2);
  lcd.print("3 - Luz UV");
  lcd.setCursor(0,3);
  lcd.print("4 - Corrosao");
  do{
  key = kpd.getKey();
  if (key=='1') 
      centrifuga();
  else if (key=='2')
      secagem();
  else if (key=='3') 
      luzvioleta();
  else if (key=='4') 
      corrosao();
  else if(key == 'D')
      displaylcd();
  }while(key != '#');
}


void configuracoes()
{
  String str;
  unsigned long tempo;
  lcd.clear();
  lcd.setCursor(0,0);
  lcd.print("Mudar tempo de uma");
  lcd.setCursor(0,1);
  lcd.print("funcao");
  lcd.setCursor(0,3);
  lcd.print("Escolha a funcao...");
  delay(7000);
  lcd.clear();
  lcd.setCursor(0,0);
  lcd.print("Digite o numero da funcao");
  delay(8000);
  lcd.clear();
  lcd.setCursor(0,0);
  lcd.print("1 - Centrifuga");
  lcd.setCursor(0,1);
  lcd.print("2 - Secagem");
  lcd.setCursor(0,2);
  lcd.print("3 - Luz Violeta");
  lcd.setCursor(0,3);
  lcd.print("4 - Corrosao");
  tempo = millis();
  do{
    key = kpd.getKey();
    if(key){
      if(key == '1'){
        lcd.clear();
        tempo_Centrifuga = 0;
        do{
          lcd.setCursor(0,0);
          key = kpd.getKey();
          if(key && key != '#'){
            str += String(key);
            tempo_Centrifuga = str.toInt();
            timeCent = tempo_Centrifuga/1000;
            lcd.print(tempo_Centrifuga);
          }
        }while(key != '*');
        break;
      }else if( key == '2'){
        lcd.clear();
        tempo_Secagem = 0;
        do{
          lcd.setCursor(0,0);
          key = kpd.getKey();
          if(key && key != '#'){
            str += String(key);
            tempo_Secagem = str.toInt();
            timeSecagem = tempo_Secagem/1000;
            lcd.print(tempo_Secagem);
          }
        }while(key != '*');
        break;
      }else if( key == '3'){
        lcd.clear();
        tempo_LV = 0;
        do{
          lcd.setCursor(0,0);
          key = kpd.getKey();
          if(key && key != '#'){
            str += String(key);
            tempo_LV = str.toInt();
            timeLV = tempo_LV/1000;
            lcd.print(tempo_LV);
          }
        }while(key != '*');
        break;
      }else if( key == '4'){
        lcd.clear();
        tempo_Corrosao = 0;
        do{
          lcd.setCursor(0,0);
          key = kpd.getKey();
          if(key && key != '#'){
            str += String(key);
            tempo_Corrosao = str.toInt();
            timeCorrosao = tempo_Corrosao/1000;
            lcd.print(tempo_Corrosao);
          }
        }while(key != '*');
        break;
      }
    }
  }while((millis() - tempo) < 60000);
  lcd.clear();
  displaylcd();
}

void ajuda()
{

}

void centrifuga()
{
  unsigned long tempo = 0;
  int contador = 0;
  lcd.clear();
  lcd.setCursor(0, 0);
  lcd.print("Centrifugando...");
  delay(2000);
  lcd.clear();
  lcd.print("Pressione para iniciar");
  do {
    key = kpd.getKey();
  } while (key != '*');
  lcd.clear();
  digitalWrite(MotorPin, HIGH);
  tempo = millis();
  for (contador; (millis() - tempo < tempo_Centrifuga) && (contador < timeCent); contador++)
  {
    lcd.print("Centrifugando");
    lcd.print(contador);
    delay(1000);
    lcd.clear();
    tempo = millis();
  }
  digitalWrite(MotorPin, LOW);
  do {
    tone(buzzer, 261);
    key = kpd.getKey();
  } while (key != '*');
  noTone(buzzer);
}

void secagem()
{
  //15 minutos quente
  //2 minutos frio (opcional)
  unsigned long tempo = 0;
  int contador = 0;

  lcd.clear();
  lcd.setCursor(0, 0);
  lcd.print("Secagem...");
  delay(3000);
  lcd.setCursor(0, 1);
  lcd.print("Pressione para iniciar");
  do {
    key = kpd.getKey();
  } while (key != '*');
  lcd.clear();
  lcd.setCursor(7, 0);
  lcd.print("Secando");
  delay(3000);
  lcd.clear();
  lcd.setCursor(10, 1);
  tempo = millis();
  digitalWrite(releSecador, LOW);
  tempo = millis();
  for (contador; millis() - tempo < tempo_Secagem && contador < timeSecagem; contador++)
  {
    lcd.print("Secando...");
    lcd.print(contador);
    delay(1000);
    lcd.clear();
    tempo = millis();
  }
  digitalWrite(releSecador, HIGH);
  lcd.setCursor(0,0);
  lcd.print("Aperte * para desligar");
  do {
    tone(buzzer, 261);
    key = kpd.getKey();
  } while (key != '*');
  noTone(buzzer);
}

void luzvioleta()
{
  //3 minutos
  unsigned long tempo = 0;
  int contador = 0;

  lcd.clear();
  lcd.setCursor(7, 0);
  lcd.print("Luz UV");
  delay(3000);
  lcd.clear();
  lcd.setCursor(10, 1);
  tempo = millis();
  digitalWrite(releuv, LOW);
  for (contador; millis() - tempo < tempo_LV && contador < timeLV; contador++)
  {
    lcd.print("Luz UV...");
    lcd.print(contador);
    delay(1000);
    lcd.clear();
    tempo = millis();
  }
  digitalWrite(releuv, HIGH);
  lcd.setCursor(0,0);
  lcd.print("Aperte * para desligar");
  do {
    tone(buzzer, 261);
    key = kpd.getKey();
  } while (key != '*');
  noTone(buzzer);
}

void corrosao()
{
  //15 a 20 minutos
  unsigned long tempo = 0;
  int contador = 0;

  lcd.clear();
  lcd.setCursor(7, 0);
  lcd.print("Corrosao...");
  delay(3000);
  lcd.setCursor(0, 1);
  lcd.print("Pressione para iniciar");
  do {
    key = kpd.getKey();
  } while (key != '*');
  lcd.clear();
  lcd.setCursor(7, 0);
  lcd.print("Corroendo");
  lcd.setCursor(10, 1);
  tempo = millis();
  digitalWrite(releSecador, LOW);
  for (contador; millis() - tempo < tempo_Corrosao && contador < timeCorrosao; contador++)
  {
    lcd.print("Corroendo...");
    lcd.print(contador);
    delay(1000);
    lcd.clear();
    tempo = millis();
  }
  digitalWrite(releSecador, HIGH);
  lcd.setCursor(0,0);
  lcd.print("Aperte * para desligar");
  do {
    tone(buzzer, 261);
    key = kpd.getKey();
  } while (key != '*');
  noTone(buzzer);
}
