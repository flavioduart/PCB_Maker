//#include <Keyboard.h>
#include <LiquidCrystal.h>

int botao = 7;
int estadoBotao;
int contador = 0;
int buzzer = 1;
int releuv = 11;
int releSecador = 11; //Tem que colocar uma noca porta
int latchPin = 10;  //Pino conectado ao pino 10 do 74HC595 (Latch).
int dataPin = 6;  //Pino conectado ao pino 6 do 74HC595 (Data).
int clockPin = 13; //Pino conectado ao pino 13 do 74HC595 (Clock).

#define MotorPin 9
#define timeCent 11
#define timeSecagem 11
#define timeLV 16
#define timeCorrosao 11
#define tempo_Centrifuga 11000
#define tempo_Secagem	11000
#define tempo_LV		16000
#define tempo_Corrosao 	11000

void modoautomatico();
void displaylcd();
void modomanual();
void configuracoes();
void ajuda();
void centrifuga();
void secagem();
void luzvioleta();
void corrosao();

LiquidCrystal lcd(12, 8, 5, 4, 3, 2);

void setup()
{
  pinMode(botao, INPUT);
  pinMode(MotorPin, OUTPUT);
  pinMode(latchPin,OUTPUT);
  pinMode(dataPin,OUTPUT);
  pinMode(clockPin,OUTPUT);
  pinMode(releuv, OUTPUT);
  pinMode(releSecador, OUTPUT);
  lcd.begin(20, 4);
  Serial.begin(9600);
}

void loop()
{
  displaylcd();
}

void displaylcd()
{
  unsigned long time;
  lcd.clear();
  lcd.cursor();
  lcd.blink();
  lcd.setCursor(0, 0);
  lcd.print("->Modo Automatico");
  lcd.setCursor(0, 1);
  lcd.print("Aperte o botao");
  time = millis();
  do {
    estadoBotao = digitalRead(botao);
    if (estadoBotao == HIGH) {
      modoautomatico();
    }
  } while (millis() - time < 3001);
  lcd.clear();
  lcd.setCursor(0, 0);
  lcd.print("->Modo Manual");
  lcd.setCursor(0, 1);
  lcd.print("Aperte o botao");
  time = millis();
  do {
    estadoBotao = digitalRead(botao);
    if (estadoBotao == HIGH) {
      modomanual();
    }
  } while (millis() - time < 3001);
  lcd.clear();
  lcd.setCursor(0, 0);
  lcd.print("->Configuracoes");
  lcd.setCursor(0, 1);
  lcd.print("Aperte o botao");
  time = millis();
  do {
    estadoBotao = digitalRead(botao);
    if (estadoBotao == HIGH) {
      configuracoes();
    }
  } while (millis() - time < 3001);
  lcd.clear();
  lcd.setCursor(0, 0);
  lcd.print("->Ajuda");
  lcd.setCursor(0, 1);
  lcd.print("Aperte o botao");
  time = millis();
  do {
    estadoBotao = digitalRead(botao);
    if (estadoBotao == HIGH) {
      ajuda();
    }
  } while (millis() - time < 3001);
}

void modoautomatico()
{
  lcd.clear();
  lcd.setCursor(0, 0);
  lcd.print("Incializando...");
  delay(8000);
  lcd.clear();
  lcd.cursor();
  lcd.setCursor(0, 0);
  lcd.print("->Lave a placa");
  lcd.setCursor(0, 1);
  lcd.print("->com bombril");
  delay(5000);
  lcd.clear();
  lcd.cursor();
  lcd.setCursor(0, 0);
  lcd.print("-> Apos o termino");
  lcd.setCursor(0, 1);
  lcd.print("Pressione o botao");
  do {
    estadoBotao = digitalRead(botao);
  } while (estadoBotao != HIGH);
  lcd.clear();
  lcd.cursor();
  lcd.setCursor(0, 0);
  lcd.print("->Seque a placa");
  delay(5000);
  lcd.clear();
  lcd.cursor();
  lcd.setCursor(0, 0);
  lcd.print("-> Apos o termino");
  lcd.setCursor(0, 1);
  lcd.print("Pressione o botao");
  do {
    estadoBotao = digitalRead(botao);
  } while (estadoBotao != HIGH);
  lcd.clear();
  lcd.cursor();
  lcd.setCursor(0, 0);
  lcd.print("->Pinte a placa");
  delay(5000);
  lcd.clear();
  lcd.cursor();
  lcd.setCursor(0, 0);
  lcd.print("-> Apos o termino");
  lcd.setCursor(0, 1);
  lcd.print("Pressione o botao");
  do {
    estadoBotao = digitalRead(botao);
  } while (estadoBotao != HIGH);
  lcd.clear();
  lcd.setCursor(0, 0);
  lcd.print("->Agora vamos usar a");
  lcd.setCursor(5, 1);
  lcd.print("->Centrifuga");
  delay(5000);
  centrifuga();
  lcd.clear();
  lcd.setCursor(0, 0);
  lcd.print("->Vamos usar");
  lcd.setCursor(0, 1);
  lcd.print("a secagem");
  delay(5000);
  secagem();
  lcd.clear();
  lcd.setCursor(0, 0);
  lcd.print("->Colocar o");
  lcd.setCursor(0 , 1);
  lcd.print("fotolito");
  delay(5000);
  lcd.clear();
  lcd.cursor();
  lcd.setCursor(0, 0);
  lcd.print("-> Apos o termino");
  lcd.setCursor(0, 1);
  lcd.print("Pressione o botao");
  do {
    estadoBotao = digitalRead(botao);
  } while (estadoBotao != HIGH);
  lcd.clear();
  lcd.setCursor(0, 0);
  lcd.print("->Usar a luz ultravioleta");
  delay(5000);
  luzvioleta();
  lcd.clear();
  lcd.setCursor(0, 0);
  lcd.print("->Usar a barrilha");
  delay(5000);
  lcd.clear();
  lcd.cursor();
  lcd.setCursor(0, 0);
  lcd.print("-> Apos o termino");
  lcd.setCursor(0, 1);
  lcd.print("Pressione o botao");
  do {
    estadoBotao = digitalRead(botao);
  } while (estadoBotao != HIGH);
  lcd.clear();
  lcd.cursor();
  lcd.setCursor(0, 0);
  lcd.print("->Retirar a tinta");
  delay(5000);
  lcd.clear();
  lcd.cursor();
  lcd.setCursor(0, 0);
  lcd.print("-> Apos o termino");
  lcd.setCursor(0, 1);
  lcd.print("Pressione o botao");
  do {
    estadoBotao = digitalRead(botao);
  } while (estadoBotao != HIGH);
  lcd.clear();
  lcd.cursor();
  lcd.setCursor(0, 0);
  lcd.print("->Novamente usar");
  lcd.setCursor(0, 1);
  lcd.print("a luz UV");
  delay(5000);
  luzvioleta();
  lcd.clear();
  lcd.cursor();
  lcd.setCursor(0, 0);
  lcd.print("->Usar o hipercloreto");
  delay(5000);
  corrosao();
  lcd.clear();
  lcd.setCursor(0, 0);
  lcd.print("->Lavar placa");
  delay(5000);
  lcd.setCursor(0, 1);
  lcd.print("->Usar soda caustica");
  delay(5000);
  lcd.setCursor(0, 2);
  lcd.print("->Cortar e lixar placa");
  delay(5000);
  lcd.setCursor(0, 3);
  lcd.print("->Trabalhar as legendas");
  delay(5000);
  lcd.clear();
  lcd.setCursor(0, 0);
  lcd.print("->Agora, repetir as etapas de:");
  delay(5000);
  lcd.setCursor(0, 1);
  lcd.print("->Limpar, Pintar, Centrifugar, Secar");
  delay(5000);
  lcd.setCursor(0, 2);
  lcd.print("->Colocar a mascara");
  delay(5000);
  lcd.setCursor(0, 3);
  lcd.print("->Utilizar barrilha");
  delay(5000);
  lcd.clear();
  lcd.setCursor(5, 1);
  lcd.print("Processo Finalizado");
  displaylcd();
}

void modomanual()
{
  unsigned long time;
  lcd.clear();
  lcd.cursor();
  lcd.blink();
  lcd.setCursor(0, 0);
  lcd.print("Qual processo");
  lcd.setCursor(0, 1);
  lcd.print("deseja ativar?");
  delay(3000);
  lcd.clear();
  lcd.setCursor(0, 0);
  lcd.print("->Centrifuga?");
  lcd.setCursor(0, 1);
  lcd.print("Aperte o botao");
  time = millis();
  do {
    estadoBotao = digitalRead(botao);
    if (estadoBotao == HIGH) {
      centrifuga();
      time = 0;
      lcd.clear();
      lcd.setCursor(0, 1);
      lcd.print("Se deseja ativar");
      lcd.setCursor(0, 2);
      lcd.print("outro processo,");
      lcd.setCursor(0, 3);
      lcd.print("aperte o botao");
      time = millis();
      do {
        estadoBotao = digitalRead(botao);
        if (estadoBotao == HIGH)
          modomanual();
      } while (millis() - time < 3001);
      displaylcd();
    }
  } while (millis() - time < 3001);
  lcd.setCursor(0, 2);
  lcd.print("->Secagem?");
  lcd.setCursor(0, 3);
  lcd.print("Aperte o botao 2");
  do {
    estadoBotao = digitalRead(botao);
    if (estadoBotao == HIGH)
    {
      secagem();
      time = 0;
      lcd.clear();
      lcd.setCursor(0, 1);
      lcd.print("Se deseja ativar");
      lcd.setCursor(0, 2);
      lcd.print("outro processo,");
      lcd.setCursor(0, 3);
      lcd.print("aperte o botao");
      time = millis();
      do {
        estadoBotao = digitalRead(botao);
        if (estadoBotao == HIGH)
          modomanual();
      } while (millis() - time < 3001);
      displaylcd();
    }
  } while (millis() - time < 3001);
  lcd.clear();
  lcd.setCursor(0, 0);
  lcd.print("->Luz Ultravioleta?");
  lcd.setCursor(0, 1);
  lcd.print("Aperte o botao 3");
  time = millis();
  do {
    estadoBotao = digitalRead(botao);
    if (estadoBotao == HIGH)
    {
      luzvioleta();
      time = 0;
      lcd.clear();
      lcd.setCursor(0, 1);
      lcd.print("Se deseja ativar");
      lcd.setCursor(0, 2);
      lcd.print("outro processo,");
      lcd.setCursor(0, 3);
      lcd.print("aperte o botao");
      time = millis();
      do {
        estadoBotao = digitalRead(botao);
        if (estadoBotao == HIGH)
          modomanual();
      } while (millis() - time < 3001);
      displaylcd();
    }
  } while (millis() - time < 3001);
  lcd.setCursor(0, 2);
  lcd.print("->Corrosao?");
  lcd.setCursor(0, 3);
  lcd.print("Aperte o botao");
  time = millis();
  do {
    estadoBotao = digitalRead(botao);
    if (estadoBotao == HIGH)
    {
      corrosao();
      time = 0;
      lcd.clear();
      lcd.setCursor(0, 1);
      lcd.print("Se deseja ativar");
      lcd.setCursor(0, 2);
      lcd.print("outro processo,");
      lcd.setCursor(0, 3);
      lcd.print("aperte o botao");
      time = millis();
      do {
        estadoBotao = digitalRead(botao);
        if (estadoBotao == HIGH)
          modomanual();
      } while (millis() - time < 3001);
      displaylcd();
    }
  } while (millis() - time < 3001);
  lcd.clear();
}

void configuracoes()
{
  //Precisa da Matriz 4x4
}

void ajuda()
{

}

void centrifuga()
{
  unsigned long tempo = 0;
  int contador = 0;
  lcd.clear();
  lcd.setCursor(0, 0);
  lcd.print("Centrifugando...");
  delay(2000);
  lcd.clear();
  lcd.print("Pressione para iniciar");
  do {
    estadoBotao = digitalRead(botao);
  } while (estadoBotao != HIGH);
  lcd.clear();
  digitalWrite(MotorPin, HIGH);
  tempo = millis();
  for (contador; (millis() - tempo < tempo_Centrifuga) && (contador < timeCent); contador++)
  {
    lcd.print("Centrifugando");
    lcd.print(contador);
    delay(1000);
    lcd.clear();
    tempo = millis();
  }
  digitalWrite(MotorPin, LOW);
  do {
    tone(buzzer, 261);
  } while (estadoBotao != HIGH);
  noTone(buzzer);
}

void secagem()
{
  //15 minutos quente
  //2 minutos frio (opcional)
  unsigned long tempo = 0;
  int contador = 0;

  lcd.clear();
  lcd.setCursor(0, 0);
  lcd.print("Secagem...");
  delay(3000);
  lcd.setCursor(0, 1);
  lcd.print("Pressione para iniciar");
  do {
    estadoBotao = digitalRead(botao);
  } while (estadoBotao != HIGH);
  lcd.clear();
  lcd.setCursor(7, 0);
  lcd.print("Secando");
  delay(3000);
  lcd.clear();
  lcd.setCursor(10, 1);
  tempo = millis();
  digitalWrite(releSecador, HIGH);
  tempo = millis();
  for (contador; millis() - tempo < tempo_Secagem && contador < timeSecagem; contador++)
  {
    lcd.print("Secando...");
    lcd.print(contador);
    delay(1000);
    lcd.clear();
    tempo = millis();
  }
  digitalWrite(releSecador, LOW);
  do {
    tone(buzzer, 261);
  } while (estadoBotao != HIGH);
  noTone(buzzer);
}

void luzvioleta()
{
  //3 minutos
  unsigned long tempo = 0;
  int contador = 0;

  lcd.clear();
  lcd.setCursor(7, 0);
  lcd.print("Luz UV");
  delay(3000);
  lcd.clear();
  lcd.setCursor(10, 1);
  tempo = millis();
  digitalWrite(releuv, HIGH);
  for (contador; millis() - tempo < tempo_LV && contador < timeLV; contador++)
  {
    lcd.print("Luz UV...");
    lcd.print(contador);
    delay(1000);
    lcd.clear();
    tempo = millis();
  }
  digitalWrite(releuv, LOW);
  do {
    tone(buzzer, 261);
  } while (estadoBotao != HIGH);
  noTone(buzzer);
}

void corrosao()
{
  //15 a 20 minutos
  unsigned long tempo = 0;
  int contador = 0;

  lcd.clear();
  lcd.setCursor(7, 0);
  lcd.print("Corrosao...");
  delay(3000);
  lcd.setCursor(0, 1);
  lcd.print("Pressione para iniciar");
  do {
    estadoBotao = digitalRead(botao);
  } while (estadoBotao != HIGH);
  lcd.clear();
  lcd.setCursor(7, 0);
  lcd.print("Corroendo");
  lcd.setCursor(10, 1);
  tempo = millis();
  digitalWrite(releSecador, HIGH);
  for (contador; tempo < tempo_Corrosao && contador < timeCorrosao; contador++)
  {
    lcd.print("Corroendo...");
    lcd.print(contador);
    delay(1000);
    lcd.clear();
    tempo = millis();
  }
  digitalWrite(releSecador, LOW);
  do {
    tone(buzzer, 261);
  } while (estadoBotao != HIGH);
  noTone(buzzer);
}

